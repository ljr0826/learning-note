# 通用表单插件

表单插件分为：
- 页面级别（很多地方可以写死，写起来很轻松
- 站点级别（写的js在一个网站即多个页面里通用，难度也没有太高；类的名称等可以做很多假设即很多可以写死
- 插件级别（最可怕，即使是小功能都不简单；所有网站都通用
- 产品级别（也是插件级别的一种。所有公司都可以用，要求功能足够灵活

功能越通用，越困难。要减少工作量，提高效率

要考虑的事情：一个form-item就是一个表单项即一个div、div里面包含提示文字、文本框/下拉列表等和错误消息

用html和css写表单往往使用css类样式控制错误消息的样式

input的name属性发送到服务器代表属性名

div元素若加上contenteditable属性也可以编辑
```html
    <div contenteditable="true"></div>
```

**考虑**

要做一个东西的时候，分析这个步骤是省不了的。

**自定义属性的约定**

1. 可以通过插件，配置错误的类名。如果没有配置，使用默认的类名：field-error
   1. 约定：错误类名，应该加到表单项/表单域/表单字段的容器中
2. 【必填】约定：表单域(字段)容器是一个具有自定义属性```data-field-container```的元素，该属性的值必须等于表单字段名即表单的name属性值
   1. 若表单没有name属性或表单不发送到服务器。即怎么通过容器找到要验证的东西
3. 【必填】约定：要验证的表单域（字段）应该具有自定义属性```data-field```，该属性没有值；只要标记了该属性有几个验证几个
   1. 要验证该表单域的那个属性呢。可能是图片的src属性、多选框的是否选中、单选框的value等
4. 约定：要验证的属性使用自定义属性```data-field-prop```指定，如果没有指定。验证value属性
   1. 什么情况下触发验证？input事件、change事件等
5. 约定：要监听的属性使用自定义属性```data-field-listener```指定要监听的事件。如果没有指定默认使用change事件
6. 约定：触发哪些表单域的相关验证，默认情况下只处理自身的验证。可以通过```data-field-trigger```设置要验证的其他表单域，多个名称之间使用英文逗号分隔，中间不能有空格（即trigger的值与container的值对应
7. 约定：通过自定义属性```data-field-error```表示错误消息的元素，如果不写则寻找类样式error
   1. 要创建一个表单验证对象，所以需要把表单的dom元素给我

**构造函数的参数**

1. 表单的dom对象（特别注意，一个表单的dom对象不一定是form元素，ajax即是通过js发送信息到服务器等
2. 错误的类名，默认为field-error
3. ！所有表单域的验证规则，这里，称之为表单规则；是最重要的
   1. 表单规则是一个对象
   2. 对象中的每一个属性名，对应表单的字段名即field-container的属性值
   3. 属性值表示规则数组。数组是因为每一个表单字段可能有多个规则；该插件验证时，会根据数组中提供的规则顺序进行验证，所有的验证都是同步的（即一个完了再下一个。es6之后有异步的方法）并且，规定如果一个验证失败，不会再进行后续规则的验证
4. 每一个具体规则是一个对象，该对象中包含两个属性：
   1. rule属性，表示具体的规则，有三种取值
      1. 预设值，即单词：
         1. required：表示必填
         2. mail：表示邮箱
         3. number：表示数字
         4. 将来可能插件升级后，会有更多的预设值
      2. 正则表达式
      3. 最灵活的方式：即还可以是一个验证函数（比如重新确认密码时的功能实现）使用验证消息后message消息无效
         1. 函数具有两个参数
            1. value：表示当前表单域的值
            2. formData：表示整个表单数据
         2. 函数如果验证通过，返回true；否则返回错误消息
   2. message属性，表示错误消息。是一个字符串

**通过构造函数创建的对象**

1. 自动的，会根据相应的配置，对表单进行自动验证
2. 提供validate方法，并且该方法返回验证结果
   1. 无参：验证整个表单
   2. 有参：验证指定的表单域
3. 提供getFormData方法，该方法返回整个表单对象（es6学习symble学习做一些私有的属性

之后是要学习使用表单验证插件的。（使用都要学的更不要说开发了

没有思路的时候，就从最基本的功能开始写函数（造螺丝钉）

> dataset会改变命名方式，改为小驼峰命名法；getAttribute不会
> 正则表达式验证null或数组时会将其默认转换为字符串，再进行验证