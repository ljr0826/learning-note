# 数字的存储

本节课虽然解决的问题很简单，但是难度是很高的；重在理解，对这个知识点有一个概括的了解，有点晕很正常，可以自己多实验练习一下

**在对精度要求很高的系统中，或要对小数的运算结果进行比较时，需要特别谨慎**

## 问题

1. js中的小数运算是精确的吗？

不一定

2. js中的整数运算是精确的吗？

不一定，一般是很大的整数运算会有不精确的情况
这种现象通常情况下不会出现太大的问题，但是会影响数字之间比较的情况；日后有处理方法

3. js中表示的整数是连续的吗？

不是，当js数字很大的时候可能就不是连续的了

4. js中表示的最大数字是多少？

最大连续整数（从一开始数到这个数字一直是连续的，并且这个数字到下一个数字也是连续的，再下一个就不是了）：
    - 通过```window.Number.MAX_SAFE_INTEGER```查看

5. js中能表示的数字的有效位数是多少？

16 ~ 17位不固定，表示整数只有16位，小数可能17位

## 解释这些问题发生的原因

### 了解二进制

现实世界中使用的数字是十进制0--9，锋十进一；

但是计算机世界中能识别的数字只有两个 0 1，因此计算机世界中是二进制，两个数字，逢二进一

二进制---->十进制

1101---> $1*2^3+1*2^2+0*2^1+1*2^0=13$

11.01 ---> $1*2^1+1*2^0+0*2^{-1}+1*2^{-2}=3.25$

十进制 -----> 二进制

13-->1101

```
13/ 2    商6    余1
6 / 2    商3    余0
3 / 2    商1    余1
1 / 2    商0    余1
余数从下往上看就是二进制（除到商为0为止）
```

3.25--->11.01

整数部分一样
小数部分：

```
0.25 * 2     0.5   整数部分：0
0.5*2        1.0   整数部分：1
整数部分从上往下看（乘到小数部分为0为止）
```

## 为什么js的小数运算不精确

因为十进制的小数转换为二进制后可能是无限小数，但是计算机对数字的存储能力是有限的。因此会丢失一些数据。就导致小数的存储本身就是不精确的

比如十进制数0.3--->二进制0.01001...

```
0.3 * 2     0.6   整数部分：0
0.6 * 2     1.2   整数部分：1
0.2 * 2     0.4   整数部分：0
0.4 * 2     0.8   整数部分：0
0.8 * 2     1.6   整数部分：1
```

在程序中查看：日后会学
```js
var a = 0.3;
console.log(a.toString(2));//查看该数字的二进制格式
```

## 在js中如何存储数字

存储数字一般有两种方式：整数法（存整数）、浮点法（存小数）

js中存储的所有数字都按照浮点法存储

浮点法存放的数字，叫做浮点数float；浮点数分为单精度（能存的数字以及表示的有效数字少一些）和双精度

js中使用双精度存放浮点数，使用IEEE 754标准来存放数字

**存放方式**

js在计算机中给每个数字开辟一块内存空间，尺寸固定为64位

> 在计算机中，位bit是最小的存储单位，简称为bit，
> 1 字节byte = 8bit
> 1 KB = 1024字节byte
> 1 MB = 1024 KB
> 1 GB = 1024 MB
```
将64位分为三段[第一段：1][第二段：2~12][第三段：13~64]

第一段：1位，表示符号位，如果为1，是负数；如果为0，是负数

第二段：11位，表示指数位，这里的指数是2为底的指数，而不是10。能表示0-2047个数字，为了处理小数即负数的指数，计算时减去1023

第三段：52位，表示有效数字
```

举例：

```
0     0000 0000 011    1111  0000 0000 0000 0000 0000...

相当于：1111看成是小数部分，在前面自动加一个1，即$1.1111(换算成10进制) * 2 ^ {3-1023}$。但还不一定是这样子
```

**特殊情况**

1. 指数为0，尾数为0，表示数字0
2. 符号为0，指数为2047，尾数也为0，表示正无穷Infinity。也就是说正常指数最大取2046
3. 符号为1，指数为2047，尾数也为0，表示正无穷Infinity。
4. 指数为2047，尾数不为0，表示NaN

```
正无穷Infinity：0 1111 1111 111 0000000000000...
负无穷-Infinity：1 1111 1111 111 0000000000000...
NaN：1 1111 1111 111 1011111101000000011
```

**一个正常的数字，指数部分最多只能是2046，2046-1023=1023**

## 能表示的最大数字

```
0     1111 1111 110      111111111111111111111... 
相当于：$1.11111111111... * 2 ^ 1023$
```

> Number.MAX_VALUE查看最大整数
> Number.MIN_VALUE查看最小整数

## 能表示的最大的安全整数

安全数字：从1开始到该数字，均是连续的整数，并且该数字的下一个整数是存在的

> Number.MAX_SAFE_INTEGER查看最大的安全整数位

```
0    xxxx xxxx xxx   1111111111111...
相当于：$2 ^ 53 - 1$
```