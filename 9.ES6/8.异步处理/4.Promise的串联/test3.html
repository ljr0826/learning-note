<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
  </head>

  <body>
    <script>
      /*
                  邓哥心中有三个女神
                  有一天，邓哥决定向第一个女神表白，如果女神拒绝，则向第二个女神表白，直到所有的女神都拒绝，或有一个女神同意为止
                  用代码模拟上面的场景
              */
      //   function confess(god, callback) {
      //     console.log(`邓哥向${god}表白`);
      //     setTimeout(() => {
      //       if (Math.random() > 0.3) {
      //         callback(false);
      //       } else {
      //         callback(true);
      //       }
      //     }, 1000);
      //   }
      //   confess("女神1", (result) => {
      //     if (result) {
      //       console.log(`女神1接受了邓哥，撒花`);
      //     } else {
      //       console.log(`女神1拒绝了邓哥，邓哥继续向女神2表白`);
      //       confess("女神2", (result) => {
      //         if (result) {
      //           console.log(`女神2接受了邓哥，撒花`);
      //         } else {
      //           console.log(`女神2拒绝了邓哥，邓哥继续向女神3表白`);
      //           confess("女神3", (result) => {
      //             if (result) {
      //               console.log(`女神3接受了邓哥，撒花`);
      //             } else {
      //               console.log(`女神3拒绝了邓哥，邓哥求偶失败`);
      //             }
      //           });
      //         }
      //       });
      //     }
      //   });

      const arr = ["花城", "费渡", "长庚", "谢怜"];
      let pro;
      function confess(god) {
        return new Promise((resolve, reject) => {
          console.log(`***向${god}表白`);
          setTimeout(() => {
            if (Math.random() < 0.3) {
              resolve(true);
            } else {
              resolve(false);
            }
          }, 1000);
        });
      }
      for (let i = 0; i < arr.length; i++) {
        if (i === 0) {
          pro = confess(arr[i]);
        }
        pro = pro.then((data) => {
          //牛逼，下一步用上一步的后续处理结果
          if (data === undefined) {
            return;
          } else if (data) {
            console.log(`${arr[i]}同意了`);
            return;
          } else {
            console.log(`${arr[i]}拒绝了`);
            if (i < arr.length - 1) {
              return confess(arr[i + 1]);
            }
          }
        });
      }
    </script>
  </body>
</html>
