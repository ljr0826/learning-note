# 文件上传

这里的文件上传指的是使用ajax实现页面不刷新的上传

流程：

1. 客户端将文件数据发送给服务器(目前需要关心的，需要和服务器约定一些东西)
   1. 需要和服务器约定一个地址
   2. 请求方法是post方法，因为文件数据是很大的
   3. 请求的表单格式：multipart/form-data常用
   4. multipart/form-data要求请求体中必须包含一个键值对，键的名称是服务器要求的名称imagefile，值是文件数据

2. 服务器保存上传的文件数据到服务器端

3. 服务器响应给客户端一个文件访问地址

> 测试地址(只接受文件)：http://101.132.72.36:5100/api/upload
> 键的名称(表单域名称)：imagefile

请求方法：POST
请求的表单格式：multipart/form-data（请求体的格式比较特殊，很难构建）
请求体中必须包含一个键值对，键的名称是服务器要求的名称，值是文件数据

传统的ajax也不是不能上传文件，但是以前没有文件数据（对用户隐私造成侵犯

> HTML5 中，js 仍然无法随意的获取文件数据，但是可以获取到 input 元素中，被用户选中的文件数据

> 可以利用 HTML5 提供的 FormData 构造函数来创建请求体（请求的表单格式：multipart/form-data（请求体的格式比较特殊，很难构建）

```html
<form action="" method="post" enctype="multipart/form-data">
  <input
    type="file"
    id="avatar"
    multiple
  /><!--multiple布尔属性表示可以选中多个-->
  <input type="text" name="bcd" />
  <button>提交</button>
</form>
<script>
  async function upload() {
    const inp = document.getElementById("avatar");
    // console.log(inp.files); //打印文件信息
    if (inp.files.length === 0) {
      alert("请选择要上传的文件");
      return;
    }
    //拿到文件数据后，构建请求体
    const formData = new FormData(); //构建空的请求体
    formData.append("imagefile", inp.files[0]); //在请求体中添加文件数据，一般上传一个就行
    //发送网络请求
    const resp = await fetch("http://101.132.72.36:5100/api/upload", {
      method: "POST",
      heades: {
        "Content-Type": "multipart/form-data", //当请求体配置成formData后，可以不写
      },
      body: formData, //当请求体配置成formData后请求头中的Content-Type其实可以不写，会自动修改成multipart/form-data
    });
    const result = await resp.json();
    console.log(result);
  }
</script>
```
见test.html
