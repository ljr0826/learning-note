# 可迭代协议与 for-of 循环

## 可迭代协议

**概念回顾**

- 迭代器(iterator)：一个具有 next 方法的对象，next 方法返回下一个数据并且能指示是否迭代完成
- 迭代器创建函数(iterator creator)：一个返回迭代器的函数

学习迭代器很重要的一个目的就是为了学习可迭代协议（和es6关联起来）

**可迭代协议**

ES6 规定，如果一个对象具有知名符号属性`Symbol.iterator`，并且属性值是一个迭代器创建函数，则该对象是可迭代的(iterator)。至于有什么意义先不管

> 思考：如何知道一个对象是可迭代的？--- 有知名符号属性Symbol.iterator，且属性值是迭代器创建函数
> 思考：如何遍历一个可迭代对象？--- es6推出一个for-of循环，专门用于遍历可迭代对象

```js
const obj = {
  [Symbol.iterator]() {
    return {
      next() {
        return {
          value: 1,
          done: false,
        };
      },
    };
  },
}; //obj是可迭代对象：有知名符号属性Symbol.iterator，且属性值是迭代器创建函数
```

## for-of 循环(很常用)

es6推出一个for-of循环，专门用于遍历可迭代对象

后面很常用。以后只要遍历一个东西，只要可迭代就可以使用for-of循环遍历

for-of 循环用于遍历可迭代对象，格式如下：

```js
//迭代完成后循环结束
for (const item of iterable) {
  //iterable：可迭代对象
  //item：每次迭代得到的数据
}

const arr = [2, 5, 7, 9, 3]; //es6里，将数组做成了一个可迭代对象
const iterator = arr[Symbol.iterator](); //得到一个迭代器
//很多伪数组也是可迭代对象。比如获取的dom数组
//可迭代对象的遍历：
let result = iterator.next();
while (!result.done) {
  const item = result.value; //取出数据
  console.log(item);
  result = iterator.next();
}
//相当于使用es6推出的for-of语法糖
for (const item of arr) {
  console.log(item);
}
```

若使用for-of循环的对象不是可迭代的，则会报错

```js
const obj = {
  a: 1,
  b: 2,
  [Symbol.iterator]() {
    const keys = Object.keys(this);
    let i = 0;
    return {
      next: () => {
        const result = {
          value: { propName: keys[i], propValue: this[keys[i]] },
          done: i >= keys.length,
        };
        i++;
        return result;
      },
    };
  },
}; //实现自定义的可迭代对象的遍历。任何可迭代的对象都可以使用for-of循环
for (const item of obj) {
  console.log(item);
}
```

## 展开运算符和可迭代对象

展开运算符可以作用于可迭代对象，这样，就可以轻松的将可迭代对象转换为数据

只要是可迭代对象，就可以使用展开运算符展开(可迭代对象使用展开运算符时对数组还是对象展开没有限制)

```js
const obj = {
  a: 1,
  b: 2,
  [Symbol.iterator]() {
    const keys = Object.keys(this);
    let i = 0;
    return {
      next: () => {
        const result = {
          value: { propName: keys[i], propValue: this[keys[i]] },
          done: i >= keys.length,
        };
        i++;
        return result;
      },
    };
  },
};
const arr = [...obj]; //若obj不是可迭代对象。那么它只能展开到对象里面。这样会报错
//但一旦它是可迭代对象，就可以一个个将数据展开到数组中
console.log(arr);
//甚至调用函数的时候，也可以使用展开运算符传入可迭代对象
function test(a, b) {
  console.log(a, b);
}
test(...obj);
```