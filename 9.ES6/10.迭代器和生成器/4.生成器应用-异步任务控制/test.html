<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      //希望用生成器来完成async、await的效果
      function* task() {
        const d = yield 1; //d:1
        console.log(d);
        // const a = yield "abc";
        // console.log(a);
        const resp = yield fetch("http://101.132.72.36:5100/api/local");
        const result = yield resp.json();
        console.log(result);
      }
      run(task);

      //任何的异步处理都可以使用调用函数，将生成器函数传递进去
      function run(generatorFunc) {
        const generator = generatorFunc();
        let result = generator.next(); //开始迭代（启动任务）得到迭代数据
        handleResult();
        //对result进行处理，根据result的不同类型
        function handleResult() {
          if (result.done) {
            return; //若迭代完成，不做任何处理
          }
          //迭代没有完成，分为两种情况
          //1.迭代的数据是一个Promise
          //2.迭代的数据是其他数据
          if (typeof result.value.then === "function") {
            //1.迭代的数据是一个Promise对象。要等待promise对象完成后再进行下一次迭代
            result.value.then(
              (data) => {
                result = generator.next(data);
                handleResult();
              },
              (err) => {
                result = generator.throw(err);
                handleResult();
              }
            );
          } else {
            //2.迭代的数据是其他数据，直接进行下一次迭代
            result = generator.next(result.value);
            handleResult();
          }
        }
      }
    </script>
  </body>
</html>
