# 箭头函数

回顾：函数作用域中this 指向取决于函数是怎么被调用的、全局作用域中this指向全局对象

1. 通过对象调用函数，this 指向对象
2. 直接调用函数，this 指向全局对象
3. 如果通过 new 调用函数，this 指向新创建的对象
4. 如果通过 apply、call、bind 调用函数，this 指向指定的数据
5. 如果是 DOM 事件函数，this 指向事件源

```js
//这样一来会有很多问题。举例如下：
const obj = {
  count: 0,
  start: function () {
    //this--->obj
    const that = this
    setInterval(function () {
      //this--->window。js引擎在内部调用的
      this.count++;
      console.log(this.count);
    }, 1000);
  },
  regEvent: function () {
    window.onclick = function () {
      //this--->window。事件函数中的this指向事件源
      console.log(this.count);
    };
  },
};
obj.start();
obj.regEvent();
```

> 箭头函数解决了 js 多年以来 this 指向的问题。可以说是es6最成功的改进了

## 使用语法

1. 箭头函数是一个函数表达式。理论上，任何使用函数表达式/匿名函数的场景都可以使用箭头函数

完整语法：（少了一个function关键字，简便一些）

```js
(参数1,参数2,...)=>{
    //函数体
}
```

如果参数只有一个，可以省略小括号

```js
参数 => {
  //函数体
};
```

如果箭头函数只有一条返回语句(而且这条语句是返回的结果)，可以省略大括号和 return 关键字

```js
参数 => 返回值;
(a, b) => ({
  //对象
});

      const print = (num) => {
        console.log("给我的数字是：" + num);
      };
      print(2);
      const isOdd = (num) => num / 2 !== 0;
      console.log(isOdd(2));
      console.log(isOdd(3));
      // const sum = (a, b) => {
      //   return {
      //     a,
      //     b,
      //     sum: a + b,
      //   };
      // };
      //简写方式：
      const sum = (a, b) => ({
        a,
        b,
        sum: a + b,
      });
      console.log(sum(8, 9));
```

## 注意细节

- 箭头函数的函数体中的this，取决于箭头函数声明的位置的this指向，而与如何调用无关(箭头函数中没有this)
- 箭头函数中，不存在 this、arguments、new.target，如果使用了，则使用的是函数外层的对应的 this、arguments、new.target
- 箭头函数没有原型
- 由于箭头函数没有原型，没有this，所以箭头函数不能当作构造函数使用

```js
const func = () => {
  console.log(this);
  console.log(arguments); //外层window对象没有arguments关键字。会报错
};
func(); //this--->window
const obj = {
  method: func,
};
obj.method(); //this--->window
      const func = () => {
        console.log(this);
      };
      console.log(func);
      console.dir(func);
      console.log(func.prototype); //undefined
      console.dir(func.prototype); //undefined
      const obj = {
        method: function () {
          const func = () => {
            console.log(this); //obj
            console.log(arguments); //234
          };
          func();
        },
      };
      obj.method(234);
      //箭头函数的作用：让你临时用一下，用完就甩掉。所以也没有原型，占用内存空间特别少
```

## 应用场景

1. 临时性使用的函数，并不会调用它，比如：
   1. 事件处理函数
   2. 异步处理函数 setTimeOut/setInterval大胆的用
   3. 其他临时性的函数
2. 为了绑定外层 this 的函数
3. 在不影响其他代码的情况下，保持代码的简洁通常都会使用箭头函数；如数组方法中的回调函数

```js
const numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9];
const result = numbers
  .filter((num) => num % 2 === 0) //保留偶数
  .map((num) => num * 2) //数据*2
  .reduce((sum, num) => sum + num); //求和
console.log(result);
```

对象的属性一般不用箭头函数。会导致this指向混乱
